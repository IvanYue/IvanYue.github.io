<!DOCTYPE HTML>
<html lang="zh-Hans">
<head>
    <!--Setting-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta name="apple-mobile-web-app-capable" content="boke">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no,email=no,adress=no">
    <meta name="browsermode" content="application">
    <meta name="screen-orientation" content="portrait">
    <link rel="dns-prefetch" href="http://yoursite.com">
    <!--SEO-->





<meta name="robots" content="all" />
<meta name="google" content="all" />
<meta name="googlebot" content="all" />
<meta name="verify" content="all" />
    <!--Title-->


<title>Python读写Excel文件 | boke</title>


    <link rel="alternate" href="/atom.xml" title="boke" type="application/atom+xml">


    <link rel="icon" href="/favicon.ico">

    



<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap/3.3.4/css/bootstrap.min.css?rev=3.3.4">
<link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="/css/style.css?rev=@@hash">




    
	<div class="hide">
		<script type="text/javascript">
			var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan class='cnzz_stat_icon_1263868967 hide' %3E%3Cscript%20src%3D%22https%3A%2F%2Fs95.cnzz.com%2Fz_stat.php%3Fweb_id%3D1272564536%22%3E%3C%2Fscript%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s19.cnzz.com/z_stat.php%3Fid%3D1263868967%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
		</script>
	</div>






    
</head>


<!--[if lte IE 8]>
<style>
    html{ font-size: 1em }
</style>
<![endif]-->
<!--[if lte IE 9]>
<div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div>
<![endif]-->

<body>
    <header class="main-header"  style="background-image:url(http://7xpw2b.com1.z0.glb.clouddn.com/hexo-sinppet/img/banner2.jpg)"  >
    <div class="main-header-box">
        <a class="header-avatar" href="/" title="">
            <img src="/img/avatar.jpg" alt="logo头像">
        </a>
        <div class="branding">
        	<!--<h2 class="text-hide">Snippet主题,从未如此简单有趣</h2>-->
            
                 <img src="/img/branding.png" alt="Snippet 博客主题">  
             
    	</div>
    </div>
</header>
    <nav class="main-navigation">
    <div class="container">
        <div class="row">
            <div class="col-sm-12">
                <div class="navbar-header"><span class="nav-toggle-button collapsed" data-toggle="collapse" data-target="#main-menu" id="mnav">
                    <span class="sr-only">Toggle navigation</span>
                    <i class="fa fa-bars"></i>
                    </span>
                </div>
                <div class="collapse navbar-collapse" id="main-menu">
                    <ul class="menu">
                        
                            <li role="presentation"><a href="/"><i class="fa fa-fw "></i>Home</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/前端/"><i class="fa fa-fw "></i>前端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/后端/"><i class="fa fa-fw "></i>后端</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/工具/"><i class="fa fa-fw "></i>工具</a>
                            </li>
                        
                            <li role="presentation"><a href="/categories/资源/"><i class="fa fa-fw "></i>资源</a>
                            </li>
                        
                    </ul>
                </div>
            </div>
        </div>
    </div>
</nav>
    <section class="content-wrap">
        <div class="container">
            <div class="row">
                <main class="col-md-8 main-content m-post">
                    <p id="process"></p>
<article class="post">
    <div class="post-head">
        <h1 id="Python读写Excel文件">
            
	            Python读写Excel文件
            
        </h1>
        <div class="post-meta">
    
    
    <span class="categories-meta fa-wrap">
        <i class="fa fa-folder-open-o"></i>
        <a href="/categories/ ">
             
        </a>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-tags"></i>
        <span class="tags-meta">
            
            <a href="/tags/Python 笔记">
               Python 笔记
            </a>
            
        </span>
    </span>
    
    
    <span class="fa-wrap">
        <i class="fa fa-clock-o"></i>
        <span class="date-meta">2018/02/06</span>
    </span>
</div>

            
            
    </div>
    
    <div class="post-body post-content">
        <p>Microsoft Excel 几乎无处不在，使用 Excel 既可以保存客户、库存和雇员数据，还可以跟踪运营、销售和财务活动。人们在商业活动中使用 Excel 的方式五花八门，难以计数。</p>
<p>与 Python 的 csv 模块不同，Python 中没有处理 Excel 文件（就是带有 .xls 和 .xlsx 扩展名的文件）的标准模块。<code>xlrd</code> 和 <code>xlwt</code> 扩展包使 Python 可以在任何操作系统上处理 Excel 文件，而且对 Excel 日期型数据的支持非常好.</p>
<h4 id="内省Excel工作簿"><a href="#内省Excel工作簿" class="headerlink" title="内省Excel工作簿"></a>内省Excel工作簿</h4><p>Excel 文件与 CSV 文件至少在两个重要方面有所不同。</p>
<ol>
<li>与CSV 文件不同，Excel 文件不是纯文本文件，所以你不能在文本编辑器中打开它并查看数据</li>
<li>与 CSV 文件不同，一个 Excel 工作簿被设计成包含多个工作表，</li>
</ol>
<p>所以需要知道在不用手动打开工作簿的前提下，如何通过工作簿内省（也就是内部检查）获取其中所有工作表的信息。通过内省一个工作簿，你可以在实际开始处理工作簿中的数据之前，检查工作表的数目和每个工作表中的数据类型和数据量。<br>内省 Excel 文件有助于确定文件中的数据确实是你需要的，并对数据一致性和完整性做一个初步检查。弄清楚输入文件的数量，以及每个文件中的行数和列数，可以使你对数据处理工作的工作量和文件内容的一致性有个大致的概念。</p>
<blockquote>
<p>本节中的演示代码只解释新添加的。没有添加的都是在CSV文件读写的里面。</p>
</blockquote>
<p> <strong>确定工作簿中工作表的数量、名称和每个工作表中行列的数量</strong> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook</span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line"><span class="comment">#打开输入文件</span></span><br><span class="line">workbook = open_workbook(input_file)</span><br><span class="line">print(<span class="string">'有%s个表'</span> % workbook.nsheets)</span><br><span class="line"><span class="comment"># 遍历输入文件中的工作表</span></span><br><span class="line"><span class="keyword">for</span> worksheet <span class="keyword">in</span> workbook.sheets():</span><br><span class="line">    print(<span class="string">'表名:'</span>,worksheet.name,</span><br><span class="line">          <span class="string">'\t 行:'</span>,worksheet.nrows,</span><br><span class="line">          <span class="string">'\t 列:'</span>,worksheet.ncols)</span><br></pre></td></tr></table></figure>
<p><img src="https://ivanyue.github.io/SouceImage/Python_Excel/15172978528856.jpg" alt=""></p>
<h2 id="处理单个工作表"><a href="#处理单个工作表" class="headerlink" title="处理单个工作表"></a>处理单个工作表</h2><h3 id="1-读写Excel文件"><a href="#1-读写Excel文件" class="headerlink" title="1. 读写Excel文件"></a>1. 读写Excel文件</h3><ul>
<li><p>基础Python + xlrd + xlwt</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span>  xlrd <span class="keyword">import</span> open_workbook</span><br><span class="line"><span class="keyword">from</span>  xlwt <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"><span class="comment">#生产workbook对象，以使我们可以将结果写入用于输出的Excel文件</span></span><br><span class="line">output_workbook =  Workbook()</span><br><span class="line"><span class="comment">#为输出工作簿添加一个工作表</span></span><br><span class="line">output_worksheet = output_workbook.add_sheet(<span class="string">'jan_2013_output'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open_workbook(input_file) <span class="keyword">as</span> workbook:</span><br><span class="line">    <span class="comment">#引用名字是‘january_2013’的工作表</span></span><br><span class="line">    worksheet = workbook.sheet_by_name(<span class="string">'january_2013'</span>)</span><br><span class="line">    <span class="comment">#迭代行、列</span></span><br><span class="line">    <span class="keyword">for</span> row_index <span class="keyword">in</span> range(worksheet.nrows):</span><br><span class="line">        <span class="keyword">for</span> column_index <span class="keyword">in</span>  range(worksheet.ncols):</span><br><span class="line">            <span class="comment">#使用 xlwt 的 write 函数和行与列的索引将每个单元格的值写入输出文件的工作表</span></span><br><span class="line">            output_worksheet.write(row_index,</span><br><span class="line">                                   column_index,</span><br><span class="line">                                   worksheet.cell_value(row_index,column_index))</span><br><span class="line"><span class="comment">#保存关闭</span></span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
<p>  <img src="https://ivanyue.github.io/SouceImage/Python_Excel/15173056385699.jpg" alt=""></p>
<p>  E 列的日期变成了数字。数值 1 代表 1900 年 1 月 1 日，因为从 1900 年 1 月 0 日过去了 1 天，所以输出表的<code>Purchase Date</code> 没有格式化。xlrd 扩展包提供了其他函数来格式化日期值。<a href="http://xlrd.readthedocs.io/en/latest/api.html?highlight=cell_type#xlrd.sheet.Cell" target="_blank" rel="noopener">xlrd API文档。</a></p>
<h4 id="转换时间格式"><a href="#转换时间格式" class="headerlink" title="转换时间格式"></a>转换时间格式</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment">#可以将数值转换成日期并对日期进行格式化。</span></span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="comment">#open_workbook 打开Excel工作簿</span></span><br><span class="line"><span class="comment">#xldate_as_tuple 将Excel中的日期、时间或日期时间的数值转换成玉足，</span></span><br><span class="line"><span class="comment"># 这样就可以提取出具体的元素，并转成不同的格式</span></span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook,xldate_as_tuple</span><br><span class="line"><span class="keyword">from</span> xlwt <span class="keyword">import</span>  Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line"></span><br><span class="line">output_worksheet = output_workbook.add_sheet(<span class="string">'jan_2013_output'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open_workbook(input_file) <span class="keyword">as</span>  workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(<span class="string">'january_2013'</span>)</span><br><span class="line">    <span class="keyword">for</span> row_index <span class="keyword">in</span> range(worksheet.nrows):</span><br><span class="line">        row_list_output = []</span><br><span class="line">        <span class="keyword">for</span> col_index <span class="keyword">in</span>  range(worksheet.ncols):</span><br><span class="line">            <span class="comment"># 判断单元格里的值是否是日期数据</span></span><br><span class="line">            <span class="keyword">if</span> worksheet.cell_type(row_index,col_index)==<span class="number">3</span>:</span><br><span class="line">                print(<span class="string">'第 %d 行'</span> % row_index,<span class="string">'第 %d 列'</span> % col_index)</span><br><span class="line">                <span class="comment"># 先将单元格里的表示日期数值转换成元组</span></span><br><span class="line">                <span class="comment"># 使用cell_value 函数和行列索引来引用单元格中的值，或者使用 cell().value</span></span><br><span class="line">                <span class="comment"># workbook.datemode 为了确定是从1900年还是1904年开始计算的</span></span><br><span class="line">                date_cell = xldate_as_tuple(worksheet.cell_value(row_index,col_index),</span><br><span class="line">                                            workbook.datemode)</span><br><span class="line">                print(<span class="string">'转成元组'</span>,date_cell)</span><br><span class="line">                <span class="comment"># 使用元组的索引来引用元组的前三个元素并将它们作为参数传递给date函数来转换成date对象，</span></span><br><span class="line">                <span class="comment"># 用strftime()函数来将date对象转换成特定格式的字符串</span></span><br><span class="line">                <span class="comment"># 前3个元素也就是年、月、日</span></span><br><span class="line">                date_cell = date(*date_cell[<span class="number">0</span>:<span class="number">3</span>]).strftime(<span class="string">'%m/%d/%Y'</span>)</span><br><span class="line">                print(<span class="string">'转换成时间'</span>, date_cell)</span><br><span class="line">                row_list_output.append(date_cell)</span><br><span class="line">                <span class="comment"># 写入对应的格式化的日期</span></span><br><span class="line">                output_worksheet.write(row_index,col_index,date_cell)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="comment"># 将sheet中非表示日期的值赋给non_date_celld对象  </span></span><br><span class="line">                non_date_cell = worksheet.cell_value(row_index,col_index)</span><br><span class="line">                row_list_output.append(non_date_cell)</span><br><span class="line">                <span class="comment"># 将sheet中非日期的值位置填充到相应位置  </span></span><br><span class="line">                output_worksheet.write(row_index,col_index,non_date_cell)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>参数 workbook.datemode 是必需的，它可以使函数确定日期是基于 1900 年还是基于 1904 年，并据此将数值转换成正确的元组（在 Mac 上的某些 Excel 版本从 1904 年 1 月 1 日开始计算日期。可以参看微软的文档<a href="https://support.microsoft.com/en-us/help/214330/differences-between-the-1900-and-the-1904-date-system-in-excel" target="_blank" rel="noopener">《Excel中1900和1904年日期系统之间的区别》</a>。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import pandas as pd</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]    </span><br><span class="line">data_frame =pd.read_excel(input_file,sheetname=&apos;january_2013&apos;)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame.to_excel(writer,sheet_name = &apos;jan_13_output&apos;,index=False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</code></pre><p>   <img src="https://ivanyue.github.io/SouceImage/Python_Excel/15173720924014.jpg" alt=""></p>
<p>   <img src="https://ivanyue.github.io/SouceImage/Python_Excel/15173760533427.jpg" alt=""></p>
<h3 id="2-筛选特定行"><a href="#2-筛选特定行" class="headerlink" title="2. 筛选特定行"></a>2. 筛选特定行</h3><h4 id="1-行中的值满足某个条件"><a href="#1-行中的值满足某个条件" class="headerlink" title="1. 行中的值满足某个条件"></a>1. 行中的值满足某个条件</h4><blockquote>
<p> 任务:筛选出Sale Amount 大于￥1400的行</p>
</blockquote>
<pre><code>- 基础Python

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook,xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">#定位SaleAmount列</span><br><span class="line">sale_amount_column_index = 3</span><br><span class="line">with open_workbook(input_file) as workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    #输入文件中要写入输出文件的行的列表</span><br><span class="line">    data = []</span><br><span class="line">    #提取标题</span><br><span class="line">    header = worksheet.row_values(0)</span><br><span class="line">    data.append(header)</span><br><span class="line">    for row_index in range(1,worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        #保存销售额</span><br><span class="line">        sale_amount = worksheet.cell_value(row_index,sale_amount_column_index)</span><br><span class="line">        #判断销售额是否大于1400的行</span><br><span class="line">        if sale_amount &gt; 1400.0:</span><br><span class="line">            for column_index in range(worksheet.ncols):</span><br><span class="line">                #提取每个单元格的值</span><br><span class="line">                cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">                #提取每个单元格的类型</span><br><span class="line">                cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">                #判断是否是日期类型</span><br><span class="line">                if cell_type == 3:</span><br><span class="line">                    #格式化日期</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        #判断是否为空</span><br><span class="line">        if row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line">    print(data,&apos;\n&apos;)</span><br><span class="line">    #迭代data并写入输出文件</span><br><span class="line">    # enumerate 可以得到新的连续索引,要不就会继续使用输入文件的索引</span><br><span class="line">    for list_index,output_list in enumerate(data):</span><br><span class="line">        print(&apos;\n&apos;,&apos;list_index--output_list&apos;,list_index,output_list)</span><br><span class="line">        for element_index,element in enumerate(output_list):</span><br><span class="line">            print(&apos;element_index--element&apos;,element_index, element)</span><br><span class="line">            #按照新得到的索引填入数据</span><br><span class="line">            output_worksheet.write(list_index,element_index,element)</span><br><span class="line"></span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</code></pre><p>   <a href="http://blog.csdn.net/churximi/article/details/51648388" target="_blank" rel="noopener">python enumerate用法总结</a></p>
<p>   <img src="https://ivanyue.github.io/SouceImage/Python_Excel/15173892351887.jpg" alt="-w379"></p>
<ul>
<li>pandas</li>
</ul>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span>  pd</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file,<span class="string">'january_2013'</span>,index_col=<span class="keyword">None</span>)</span><br><span class="line">data_frame_value_meets_condition = \</span><br><span class="line">    data_frame[data_frame[<span class="string">'Sale Amount'</span>].astype(float)&gt;<span class="number">1400</span>]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_meets_condition.to_excel(writer,</span><br><span class="line">                                          sheet_name = <span class="string">'jan_13_output'</span>,</span><br><span class="line">                                          index=<span class="keyword">False</span>)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</code></pre><p>   可以使用 pandas 筛选出符合某个条件的行，指定你想判断的列的名称，并在数据框名称后面的方括号中设定具体的判断条件.</p>
<p>   如果你需要设定多个条件，那么可以将这些条件放在圆括号中，根据需要的逻辑顺序用“&amp;”或“|”连接起来。使用“&amp;”，表示两个条件必须都为真。使用“|”，表示只要一个条件为真就可以。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">data_frame[(data_frame[&apos;Sale Amount&apos;].astype(float)&gt;1400)</span><br><span class="line">               &amp; (data_frame[&apos;Customer ID&apos;].astype(float) &lt; 3000)]</span><br><span class="line"></span><br><span class="line">data_frame[(data_frame[&apos;Sale Amount&apos;].astype(float)&gt;1400)</span><br><span class="line">               | (data_frame[&apos;Customer ID&apos;].astype(float) &lt; 3000)]</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="2-行中的值属于某个集合"><a href="#2-行中的值属于某个集合" class="headerlink" title="2. 行中的值属于某个集合"></a>2. 行中的值属于某个集合</h4><pre><code>&gt; 任务：购买日期是&apos;01/24/2013&apos;,&apos;01/31/2013&apos;这两个日期的

 - 基础Python + xlwt + xlrd 实现


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">from</span> xlwt <span class="keyword">import</span> Workbook</span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook,xldate_as_tuple</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_fiel = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line"></span><br><span class="line">output_worksheet = output_workbook.add_sheet(<span class="string">'jan_2013_output'</span>)</span><br><span class="line">important_dates = [<span class="string">'01/24/2013'</span>,<span class="string">'01/31/2013'</span>]</span><br><span class="line">purchase_date_column_index=<span class="number">4</span></span><br><span class="line"><span class="keyword">with</span> open_workbook(input_file) <span class="keyword">as</span>  workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(<span class="string">'january_2013'</span>)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(<span class="number">0</span>)</span><br><span class="line">    data.append(header)</span><br><span class="line">    <span class="keyword">for</span> row_index <span class="keyword">in</span> range(<span class="number">1</span>,worksheet.nrows):</span><br><span class="line">        purchase_date_time = \</span><br><span class="line">            xldate_as_tuple(worksheet.cell_value(row_index,purchase_date_column_index)</span><br><span class="line">                            ,workbook.datemode)</span><br><span class="line">        purchase_date = date(*purchase_date_time[<span class="number">0</span>:<span class="number">3</span>]).strftime(<span class="string">'%m/%d/%Y'</span>)</span><br><span class="line">        row_list = []</span><br><span class="line">        <span class="comment">#判断是否在important_dates中</span></span><br><span class="line">        <span class="keyword">if</span> purchase_date <span class="keyword">in</span> important_dates:</span><br><span class="line">            <span class="keyword">for</span> column_index <span class="keyword">in</span> range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">                <span class="keyword">if</span> cell_type ==<span class="number">3</span>:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[:<span class="number">3</span>]).strftime(<span class="string">'%m/%d/%Y'</span>)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">        <span class="keyword">if</span> row_list:</span><br><span class="line">            data.append(row_list)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> list_index,output_list <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        <span class="keyword">for</span> element_index,element <span class="keyword">in</span> enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index,element_index,element)</span><br><span class="line">output_workbook.save(output_fiel)</span><br></pre></td></tr></table></figure>


 - pandas 实现

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span>  pd</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line">data_frame = pd.read_excel(input_file,<span class="string">'january_2013'</span>,index_col=<span class="keyword">None</span>)</span><br><span class="line">important_datas = [<span class="string">'01/24/2013'</span>,<span class="string">'01/31/2013'</span>]</span><br><span class="line">data_frame_value_in_set = data_frame[data_frame[<span class="string">'Purchase Date'</span>].isin(important_datas)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_in_set.to_excel(writer,sheet_name = <span class="string">'jan_13_output'</span>,index=<span class="keyword">False</span>)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</code></pre><h4 id="3-行中的值匹配与特定的正则表达式"><a href="#3-行中的值匹配与特定的正则表达式" class="headerlink" title="3. 行中的值匹配与特定的正则表达式"></a>3. 行中的值匹配与特定的正则表达式</h4><pre><code>&gt; 任务：客户姓名以大写字母 J 开头 

- python + re + xlrd + xlwt


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re,sys</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook,xldate_as_tuple</span><br><span class="line"><span class="keyword">from</span> xlwt <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(<span class="string">'jan_2013_output'</span>)</span><br><span class="line"><span class="comment"># 使用re模块的compile函数创建一个正则表达式pattern</span></span><br><span class="line"><span class="comment"># ?P&lt;my_pattern&gt; 捕获了名为 &lt;my_pattern&gt; 的组中匹配了的子字符串</span></span><br><span class="line"><span class="comment">#  ^J.* 符号（^ ）表示“在字符串开头搜索模式” , (.*) 除换行符之外的任意字符</span></span><br><span class="line">pattren = re.compile(<span class="string">r'(?P&lt;my_pattern&gt;^J.*)'</span>)</span><br><span class="line"></span><br><span class="line">custom_name_column_index = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open_workbook(input_file) <span class="keyword">as</span> workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(<span class="string">'january_2013'</span>)</span><br><span class="line">    data = []</span><br><span class="line">    header = worksheet.row_values(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    data.append(header)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> row_index <span class="keyword">in</span> range(<span class="number">1</span>,worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        <span class="comment"># 匹配 </span></span><br><span class="line">        <span class="keyword">if</span> pattren.search(worksheet.cell_value(row_index,custom_name_column_index)):</span><br><span class="line">            <span class="keyword">for</span> column_index <span class="keyword">in</span> range(worksheet.ncols):</span><br><span class="line">                cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">                cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">                <span class="keyword">if</span> cell_type==<span class="number">3</span>:</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                    date_cell = date(*date_cell[<span class="number">0</span>:<span class="number">3</span>]).strftime(<span class="string">'%m/%d/%Y'</span>)</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">            <span class="keyword">if</span> row_list:</span><br><span class="line">                data.append(row_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> list_index,output_list <span class="keyword">in</span> enumerate(data):</span><br><span class="line">        <span class="keyword">for</span> element_index ,element <span class="keyword">in</span> enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index,element_index,element)</span><br><span class="line"></span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>



&gt; ` pattren = re.compile(r&apos;(?P&lt;my_pattern&gt;^J.*)&apos;)  `

&gt; r 表示单引号之间的模式是一个原始字符串。元字符 ?P&lt;my_pattern&gt; 捕获了名为 &lt;my_pattern&gt; 的组中匹配了的子字符串，以便在需要时将它们打印到屏幕上或写入文件。我们要搜索的实际模式是 &apos; ^J.* &apos; 。插入符号（^ ）是一个特殊符号，表示“在字符串开头搜索模式”。所以，字符串需要以大写字母 J 开头。句点 . 可以匹配任何字符，除了换行符。所以除换行符之外的任何字符都可以跟在 J 后面。最后，* 表示重复前面的字符 0 次或更多次。.* 组合在一起用来表示除换行符之外的任意字符可以在 J 后面出现任意次。    
</code></pre><ul>
<li>pandas</li>
</ul>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">data_frame = pd.read_excel(input_file,<span class="string">'january_2013'</span>,index_col=<span class="keyword">None</span>)</span><br><span class="line">data_frame_value_matches_pattern = \</span><br><span class="line">    data_frame[data_frame[<span class="string">'Customer Name'</span>].str.startswith(<span class="string">'J'</span>)]</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">data_frame_value_matches_pattern.to_excel(writer,</span><br><span class="line">                                          sheet_name=<span class="string">'jan_2013_output'</span>,</span><br><span class="line">                                          index = <span class="keyword">False</span>)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</code></pre><h3 id="3-筛选特定列"><a href="#3-筛选特定列" class="headerlink" title="3. 筛选特定列"></a>3. 筛选特定列</h3><h4 id="1-使用列索引值"><a href="#1-使用列索引值" class="headerlink" title="1. 使用列索引值"></a>1. 使用列索引值</h4><pre><code>从工作表中选取特定列的一种方法是使用要保留的列的**索引值**。当你想保留的列的索引值非常**容易识别**，或者在处理多个输入文件过程中，各个输入文件中**列的位置是一致（也就是不会发生改变）**的时候，这种方法非常有效。

&gt; 任务：保留 Customer Name 和 Purchase Date 两列

- 基础Python + xlrd + xlwt

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">from datetime import date</span><br><span class="line">from xlrd import open_workbook,xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line"></span><br><span class="line">input_file = sys.argv[1]</span><br><span class="line">output_file =sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line"># 代表 CustomerName和Purchase Date</span><br><span class="line">my_columns = [1,4]</span><br><span class="line">with open_workbook(input_file) as  workbook:</span><br><span class="line">    worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">    data = []</span><br><span class="line">    for row_index in range(worksheet.nrows):</span><br><span class="line">        row_list = []</span><br><span class="line">        for column_index in my_columns:</span><br><span class="line">            cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">            cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">            if cell_type == 3:</span><br><span class="line">                date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                row_list.append(date_cell)</span><br><span class="line">            else:</span><br><span class="line">                row_list.append(cell_value)</span><br><span class="line"></span><br><span class="line">        if row_list:</span><br><span class="line">                data.append(row_list)</span><br><span class="line"></span><br><span class="line">    for list_index,output_list in enumerate(data):</span><br><span class="line">        for element_index,element in enumerate(output_list):</span><br><span class="line">            output_worksheet.write(list_index,element_index,element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li><p>pandas</p>
<ul>
<li>设置数据框，在方括号中列出要保留的列的索引值或者名称（字符串）</li>
<li>设置数据框和iloc函数。iloc函数可以同时选择特定的行与特定的列。所以使用iloc函数，就需要在列索引值前面加上一个冒号和一个逗号，表示想要为这些特定列保留所有行。否则，iloc函数也会使用这些索引值去筛选行。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">    import pandas as pd</span><br><span class="line">    import sys</span><br><span class="line">    </span><br><span class="line">    input_file = sys.argv[1]</span><br><span class="line">    output_file = sys.argv[2]</span><br><span class="line">    </span><br><span class="line">    data_frame = pd.read_excel(input_file,&apos;january_2013&apos;,index_col=None)</span><br><span class="line">    </span><br><span class="line">    data_frame_column_by_index = data_frame.iloc[:,[1,4]]</span><br><span class="line">    </span><br><span class="line">    writer = pd.ExcelWriter(output_file)</span><br><span class="line">        data_frame_column_by_index.to_excel(writer,sheet_name = &apos;jan_2013_output&apos;,index=False)</span><br><span class="line">        writer.save()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">####  2.  使用列标题/列索引值</span><br><span class="line">想保留的列的标题非常容易识别，或者在处理多个输入文件过程中，各个输入文件中列的位置会发生改变，但标题不变的时候，这种方法非常有效.</span><br><span class="line"></span><br><span class="line">&gt; 任务：保留 Customer Name 和 Purchase Date 两列。因为类似所以只展示根据列标题代码，跟据列索引的注释掉了。因为大同小异。</span><br><span class="line"></span><br><span class="line">- 基础Python + xlrd + xlwt    </span><br><span class="line">    </span><br><span class="line">    ```Python</span><br><span class="line">    </span><br><span class="line">    import sys</span><br><span class="line">    from xlwt import Workbook</span><br><span class="line">    from xlrd import open_workbook,xldate_as_tuple</span><br><span class="line">    from datetime import  date</span><br><span class="line">    </span><br><span class="line">    input_file = sys.argv[1]</span><br><span class="line">    output_file = sys.argv[2]</span><br><span class="line">    </span><br><span class="line">    output_workbook = Workbook()</span><br><span class="line">    #给输出文件中添加一个工作表</span><br><span class="line">    output_worksheet = output_workbook.add_sheet(&apos;jan_2013_output&apos;)</span><br><span class="line">    #要写入的数据添加标题</span><br><span class="line">    my_columns = [&apos;Customer ID&apos;,&apos;Purchase Date&apos;]</span><br><span class="line">    #根据列索引</span><br><span class="line">    # my_columns_index = [0,4]</span><br><span class="line">    # my_columns = []</span><br><span class="line">    </span><br><span class="line">    with open_workbook(input_file) as  workbook:</span><br><span class="line">        #按工作表名打开</span><br><span class="line">        worksheet = workbook.sheet_by_name(&apos;january_2013&apos;)</span><br><span class="line">        #要写入的数据集合</span><br><span class="line">        data = []</span><br><span class="line">        #获取输入文件的标题</span><br><span class="line">        header_list = worksheet.row_values(0)</span><br><span class="line">        #创建存标题索引的列表</span><br><span class="line">        header_index_list = []</span><br><span class="line">    </span><br><span class="line">        #根据列索引</span><br><span class="line">        # for title_index in range(len(header_list)):</span><br><span class="line">        #     if title_index in my_columns_index:</span><br><span class="line">        #         my_columns.append(header_list[title_index])</span><br><span class="line">    </span><br><span class="line">        # 要写入的数据添加标题</span><br><span class="line">        data = [my_columns]</span><br><span class="line">    </span><br><span class="line">        #迭代标题索引</span><br><span class="line">        for header_index in range(len(header_list)):</span><br><span class="line">            #判断标题是否是要写入的标题</span><br><span class="line">            if header_list[header_index] in my_columns:</span><br><span class="line">                #添加写入标题的索引</span><br><span class="line">                header_index_list.append(header_index)</span><br><span class="line">        #从索引是1的行也就是内容行开始遍历</span><br><span class="line">        for row_index in range(1,worksheet.nrows):</span><br><span class="line">            #创建要写入的内容列表</span><br><span class="line">            row_list = []</span><br><span class="line">            #遍历要写入的标题索引</span><br><span class="line">            for column_index in  header_index_list:</span><br><span class="line">                #取出表格内容</span><br><span class="line">                cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">                #获取内容类型</span><br><span class="line">                cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">                #判断是否是日期类型</span><br><span class="line">                if cell_type ==3:</span><br><span class="line">                    #把日期数据转换更元组</span><br><span class="line">                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                    #取出日期元组中的前3个，格式化</span><br><span class="line">                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                    #添加到要写入的行list中</span><br><span class="line">                    row_list.append(date_cell)</span><br><span class="line">                else:</span><br><span class="line">                    #添加要写入行list中</span><br><span class="line">                    row_list.append(cell_value)</span><br><span class="line">            #添加到要写入的list中</span><br><span class="line">            data.append(row_list)</span><br><span class="line">        #遍历要写入的数据，并给予新的索引</span><br><span class="line">        # list_index 新的行索引</span><br><span class="line">        # output_list 行中的数据列表</span><br><span class="line">        for list_index,output_list in enumerate(data):</span><br><span class="line">            # element_index 新的数据的列的索引</span><br><span class="line">            # element 数据元素</span><br><span class="line">            for element_index,element in enumerate(output_list):</span><br><span class="line">                #按行列定位写入数据</span><br><span class="line">                output_worksheet.write(list_index,element_index,element)</span><br><span class="line">    #保存关闭</span><br><span class="line">    output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p>pandas</p>
<p>  一种方式是在数据框名称后面的方括号中将列名以字符串方式列出。<br>  另外一种方式是使用 loc 函数。如果使用 loc 函数，那么需要在列标题列表前面加上一个冒号和一个逗号，表示你想为这些特定的列保留所有行。</p>
  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line">    </span><br><span class="line">    input_file = sys.argv[<span class="number">1</span>]</span><br><span class="line">    output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line">    <span class="comment">#打开输入文件对应的工作表</span></span><br><span class="line">    data_frame = pd.read_excel(input_file,<span class="string">'january_2013'</span>,index_col=<span class="keyword">None</span>)</span><br><span class="line">    <span class="comment"># 获取符合这两个标题的列</span></span><br><span class="line">    data_frame_column =\</span><br><span class="line">        data_frame[data_frame.iloc[<span class="string">'Customer ID'</span>,<span class="string">'Purchase Date'</span>]]</span><br><span class="line">    <span class="comment">#根据列索引</span></span><br><span class="line">    <span class="comment"># data_frame_column = data_frame.iloc[:,[0,4]]</span></span><br><span class="line">    <span class="comment">#写入</span></span><br><span class="line">    writer = pd.ExcelWriter(output_file)</span><br><span class="line">    data_frame_column.to_excel(writer,sheet_name = <span class="string">'jan_2013_output'</span>,index = <span class="keyword">False</span>)</span><br><span class="line">    <span class="comment">#保存</span></span><br><span class="line">    writer.save()</span><br><span class="line">    ```   </span><br><span class="line"></span><br><span class="line"><span class="comment">## 读取工作薄中的所有工作表</span></span><br><span class="line"></span><br><span class="line">如何在一个工作薄的所有工作表中筛选特定的行与列？</span><br><span class="line"></span><br><span class="line"><span class="comment">#### 在所有工作表中筛选特定行</span></span><br><span class="line"></span><br><span class="line">&gt; 任务：筛选出工作表中销售额大于 $<span class="number">2000.00</span>的所有行。</span><br><span class="line"></span><br><span class="line">- 基础Python +xlrd + xlwt</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>import  sys<br>from datetime import date<br>from xlrd import open_workbook,xldate_as_tuple<br>from xlwt import Workbook</p>
<p>input_file = sys.argv[1]<br>output_file = sys.argv[2]</p>
<p>output_workbook = Workbook()</p>
<p>output_worksheet = output_workbook.add_sheet(‘filtrrd_rows_all_worksheets’)</p>
<p>#保存 Sale Amount 列的索引值<br>sales_column_index  =3</p>
<h1 id="销售额阈值"><a href="#销售额阈值" class="headerlink" title="销售额阈值"></a>销售额阈值</h1><p>threshold = 2000.00</p>
<h1 id="判断是不是第一个工作表"><a href="#判断是不是第一个工作表" class="headerlink" title="判断是不是第一个工作表"></a>判断是不是第一个工作表</h1><p>first_worksheet = True<br>with open_workbook(input_file) as  workbook:<br>    data = []</p>
<pre><code>#遍历文件中的所有工作表
for worksheet in  workbook.sheets():
    # 判断是不是第一个工作表
    if first_worksheet:
        # 取出标题行
        header_row = worksheet.row_values(0)
        # 添加标题
        data.append(header_row)
        first_worksheet = False
    #从不是标题的地方开始迭代
    for row_index in range(1,worksheet.nrows):
        row_list = []
        # 根据 行列索引 取出 销售额
        sale_amount = worksheet.cell_value(row_index,sales_column_index)
        # Sale Amount 列中的值与阈值比较
        if sale_amount &gt; threshold:
            # 遍历符合条件工作表中的符合要求行中的数据
            for column_index in  range(worksheet.ncols):
                #获取数据的值
                cell_value = worksheet.cell_value(row_index,column_index)
                #获取数据类型
                cell_type = worksheet.cell_type(row_index,column_index)
                if cell_type ==3:
                    #日期类型数据转换格式化并添加到行list中
                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)
                    date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)
                    row_list.append(date_cell)
                else:
                    row_list.append(cell_value)
        if row_list:
            data.append(row_list)
for list_index,coutput_index in enumerate(data):
    for element_index,element in enumerate(coutput_index):
        #更具行列索引添加数据
        output_worksheet.write(list_index,element_index,element)
</code></pre><p>output_workbook.save(output_file)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- pandas</span><br><span class="line"></span><br><span class="line">    pandas 中，通过在 `read_excel` 函数中设置 `sheetname=None` ，可以一次性读取工作簿中的所有工作表。pandas 将这些工作表读入一个**数据框字典**，字典中的**键就是工作表的名称**，**值就是包含工作表中数据的数据框**。所以，通过在字典的键和值之间迭代，你可以使用工作簿中所有的数据。当你在每个数据框中筛选特定行时，结果是一个新的筛选过的数据框，所以你可以创建一个列表保存这些筛选过的数据框，然后将它们连接成一个最终数据框。</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    pandas 可以直接从多个文件中连接数据。基本过程就是将每个输入文件读取到 pandas 数据框中，将所有数据框追加到一个数据框列表，后使用 `concat()` 函数将所有数据框连接成一个数据框。`concat()` 函数可以使用 axis 参数来设置连接数据框的方式，`axis=0` 表示从头到尾垂直堆叠，`axis=1` 表示并排地平行堆叠。`ignore_index` 参数默认值为False，如果为True，会对新生成的dataframe使用新的索引（自动产生），忽略原来数据的索引。</span><br></pre></td></tr></table></figure>
<pre><code>import pandas as pd
import sys

input_file = sys.argv[1]
output_file = sys.argv[2]
# sheet_name=None 表示读取所有的工作表
# data_frame 是一个字典
data_frame = pd.read_excel(input_file,sheet_name=None,index_col=None)
row_output = []

#迭代
for worksheet_name,data in data_frame.items():
    #添加符合要求的数据
    row_output.append(data[data[&apos;Sale Amount&apos;].astype(float) &gt; 2000])
# axis=0 表示从头到尾垂直堆叠
# gnore_index 参数默认值为False，
# 如果为True，会对新生成的dataframe使用新的索引（自动产生），忽略原来数据的索引。
filtered_rows = pd.concat(row_output,axis=0,ignore_index=True)
writer = pd.ExcelWriter(output_file)
filtered_rows.to_excel(writer,sheet_name=&apos;allsheet_outPut_Amount_get2000&apos;,index=False)
writer.save()

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">#### 在所有工作表中筛选特定列</span><br><span class="line"></span><br><span class="line">&gt; 任务：选取 Customer Name 和 Sale Amount 列 </span><br><span class="line"></span><br><span class="line">- 基础Python</span><br></pre></td></tr></table></figure>

import sys
from datetime import date
from xlrd import open_workbook,xldate_as_tuple
from xlwt import Workbook

input_file = sys.argv[1]
output_file = sys.argv[2]

output_workbook = Workbook()

output_worksheet = output_workbook.add_sheet(&apos;filter_column&apos;)
#要保留的列
my_columns = [&apos;Customer Name&apos;,&apos;Sale Amount&apos;]
#判断是不是第一个工作表
frist_worksheet = True

with open_workbook(input_file) as workbook:
    data = [my_columns]
    #保存要保留的列的索引值
    index_of_cols_to_keep = []
    for worksheet in workbook.sheets():
        #是否在处理第一个工作表
        if frist_worksheet:
            header = worksheet.row_values(0)
            for column_index in range(len(header)):
                if header[column_index] in my_columns:
                    #标题索引值list
                    index_of_cols_to_keep.append(column_index)
                    frist_worksheet = False
        for row_index in  range(1,worksheet.nrows):
            row_list = []
            #只处理标题对应的列
            for column_index in index_of_cols_to_keep:
                cell_value = worksheet.cell_value(row_index,column_index)
                cell_type = worksheet.cell_type(row_index,column_index)
                if cell_type==3:
                    date_cell = xldate_as_tuple(cell_value,workbook.datemode)
                    date_cell = date(*date_cell).strftime(&apos;%m/%d/%Y&apos;)
                    row_list.append(date_cell)
                else:
                    row_list.append(cell_value)
            if row_list:
                data.append(row_list)
    for list_index,output_index in enumerate(data):
        for element_index,element in enumerate(output_index):
            output_worksheet.write(list_index, element_index, element)
output_workbook.save(output_file)

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- pandas</span><br><span class="line">使用 pandas 中的 read_excel 函数将所有工作表读入一个字典。然后，使用 loc 函数在每个工作表中选取特定的列，创建一个筛选过的数据框列表，并将这些数据框连接在一起，形成一个最终数据框。</span><br></pre></td></tr></table></figure>

import pandas as pd
import sys

input_file = sys.argv[1]
out_file = sys.argv[2]

data_frame = pd.read_excel(input_file,sheet_name=None,index_col=None)
column_output = []

for worksheet_name,data in data_frame.items():
    #loc() 选取特定的列
    column_output.append(data.loc[:, [&apos;Customer Name&apos;, &apos;Sale Amount&apos;]])
selsected_columns = pd.concat(column_output,axis=0,ignore_index=True)
writer = pd.ExcelWriter(out_file)
selsected_columns.to_excel(writer,sheet_name=&quot;all&quot;,index=False)
writer.save()

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 在Excel工作薄中读取一组工作表</span><br><span class="line"></span><br><span class="line">有时候，只需要处理Excel文件中的一部分表，比如有10张工作表，但是只需要处理其中的5张。</span><br><span class="line"></span><br><span class="line">#### 在一组工作表中筛选特定行</span><br><span class="line"></span><br><span class="line">&gt; 任务：从第一个和第二个工作表中筛选出“销售额大于 $1900.00 的那些行</span><br><span class="line"></span><br><span class="line">- 基础Python</span><br><span class="line"></span><br><span class="line">    `sheet_by_index` 或 `sheet_by_name` 函数来处理一组工作表。</span><br></pre></td></tr></table></figure>

import sys
from datetime import date
from xlrd import open_workbook,xldate_as_tuple
from xlwt import Workbook

input_file = sys.argv[1]
output_file = sys.argv[2]

output_workbook = Workbook()
output_worksheet = output_workbook.add_sheet(&apos;group_line&apos;)
my_sheet = [0,1]
threshold = 1900.00
sales_column_index = 3
fristsheet = True
with open_workbook(input_file) as workbook:
    data = []
    for sheet_index in range(workbook.nsheets):
        # 判断是不是需要的表
        if sheet_index in my_sheet:
            #根据索引获取工作表
            worksheet = workbook.sheet_by_index(sheet_index)
            #判断是不是第一次加载表
            if fristsheet:
                header_row = worksheet.row_values(0)
                data.append(header_row)
                fristsheet = False
            for row_index in  range(1,worksheet.nrows):
                row_list = []
                #获取行中是金额的数据
                sale_amount = worksheet.cell_value(row_index,sales_column_index)
                #判断是否符合要求
                if sale_amount &gt; threshold:
                    for column_index in  range(worksheet.ncols):
                        cell_value = worksheet.cell_value(row_index,column_index)
                        cell_type = worksheet.cell_type(row_index,column_index)
                        if cell_type ==3:
                            date_cell = xldate_as_tuple(cell_value,workbook.datemode)
                            date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)
                            row_list.append(date_cell)
                        else:
                            row_list.append(cell_value)
                if row_list:
                    data.append(row_list)
    for list_index,output_list in enumerate(data):
        for element_index,element in enumerate(output_list):
            output_worksheet.write(list_index,element_index,element)
output_workbook.save(output_file)

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- pandas</span><br></pre></td></tr></table></figure>

import pandas as pd
import sys

input_file = sys.argv[1]
output_file = sys.argv[2]

my_sheets = [0,1]
threshold = 1900.00

data_frame = pd.read_excel(input_file,sheet_name=my_sheets,index_col=None)
row_list = []

for worksheet_name, data in data_frame.items():
    row_list.append(data[data[&apos;Sale Amount&apos;].astype(float) &gt; threshold])

filtered_rows = pd.concat(row_list,axis=0,ignore_index=True)
writer = pd.ExcelWriter(output_file)
filtered_rows.to_excel(writer,sheet_name = &apos;all_line_group&apos;,index = False)
writer.save()    
</code></pre><h2 id="处理多个工作簿-多个Excel文件"><a href="#处理多个工作簿-多个Excel文件" class="headerlink" title="处理多个工作簿(多个Excel文件)"></a>处理多个工作簿(多个Excel文件)</h2><p>这里就要从新引入<code>glob</code>模块，来获得完整路径。</p>
<h4 id="1-工作表计数以及每个工作表中的行列计数"><a href="#1-工作表计数以及每个工作表中的行列计数" class="headerlink" title="1. 工作表计数以及每个工作表中的行列计数"></a>1. 工作表计数以及每个工作表中的行列计数</h4><p>在有些时候我们不知道文件的内容。与csv文件不同的是，excel 文件可以包含多张工作表。所以 在处理之前获取一些关于工作表的描述性信息非常重要。比如：每个工作薄中的工作表数量。每张工作表中行列的数量。</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import glob,sys,os</span><br><span class="line">from xlrd import open_workbook</span><br><span class="line"></span><br><span class="line">input_directory = sys.argv[1]</span><br><span class="line">workbook_count = 0</span><br><span class="line"></span><br><span class="line">for input_file in glob.glob(os.path.join(input_directory,&apos;*.xls*&apos;)):</span><br><span class="line">    workbook = open_workbook(input_file)</span><br><span class="line">    print(&apos;\n文件名 : %s&apos; % os.path.basename(input_file))</span><br><span class="line">    print(&apos;表的个数: %d&apos; % workbook.nsheets)</span><br><span class="line"></span><br><span class="line">    for worksheet in workbook.sheets():</span><br><span class="line">        print(&apos;表名:&apos;,worksheet.name,</span><br><span class="line">              &apos;\t行数:&apos;,worksheet.nrows,</span><br><span class="line">              &apos;\t列数:&apos;,worksheet.ncols)</span><br><span class="line">    workbook_count +=1</span><br><span class="line"></span><br><span class="line">print(&apos;Number of Excel workbooks：%d&apos; % workbook_count)</span><br></pre></td></tr></table></figure>

![-w215](media/15172842664662/15175630869905.jpg)
</code></pre><h4 id="2-从多个工作簿中连接数据"><a href="#2-从多个工作簿中连接数据" class="headerlink" title="2. 从多个工作簿中连接数据"></a>2. 从多个工作簿中连接数据</h4><ul>
<li><p>基础Python</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import sys,os,glob</span><br><span class="line">from xlrd import open_workbook,xldate_as_tuple</span><br><span class="line">from xlwt import Workbook</span><br><span class="line">from datetime import date</span><br><span class="line"></span><br><span class="line">input_folder = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(&apos;link_much_excel&apos;)</span><br><span class="line">data = []</span><br><span class="line">frist_worksheet = True</span><br><span class="line"># 迭代文件夹中的文件</span><br><span class="line">for input_file in glob.glob(os.path.join(input_folder,&apos;*.xls*&apos;)):</span><br><span class="line">    print(os.path.basename(input_file))</span><br><span class="line"></span><br><span class="line">    with open_workbook(input_file) as workbook:</span><br><span class="line">        for worksheet in workbook.sheets():</span><br><span class="line">            if frist_worksheet:</span><br><span class="line">                header_row = worksheet.row_values(0)</span><br><span class="line">                data.append(header_row)</span><br><span class="line">                frist_worksheet = False</span><br><span class="line">            for row_index in range(1,worksheet.nrows):</span><br><span class="line">                row_list = []</span><br><span class="line">                for column_index in range(worksheet.ncols):</span><br><span class="line">                    cell_value = worksheet.cell_value(row_index,column_index)</span><br><span class="line">                    cell_type = worksheet.cell_type(row_index,column_index)</span><br><span class="line">                    if cell_type==3:</span><br><span class="line">                        date_cell = xldate_as_tuple(cell_value,workbook.datemode)</span><br><span class="line">                        date_cell = date(*date_cell[0:3]).strftime(&apos;%m/%d/%Y&apos;)</span><br><span class="line">                        row_list.append(date_cell)</span><br><span class="line">                    else:</span><br><span class="line">                        row_list.append(cell_value)</span><br><span class="line"></span><br><span class="line">                if row_list:</span><br><span class="line">                    data.append(row_list)</span><br><span class="line"></span><br><span class="line">for list_index,output_list in enumerate(data):</span><br><span class="line">    for element_index,element in enumerate(output_list):</span><br><span class="line">        output_worksheet.write(list_index,element_index,element)</span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</li>
<li><p>pandas</p>
<p>  关键函数：</p>
<ul>
<li>concat() 函数来连接数据框<ul>
<li>axis = 0 垂直堆叠</li>
<li>axis = 1 水平连接</li>
</ul>
</li>
<li><p>merge()函数 可以提供类似SQL join 的操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import  pandas as pd</span><br><span class="line">import sys,os,glob</span><br><span class="line"></span><br><span class="line">input_folder = sys.argv[1]</span><br><span class="line">output_file = sys.argv[2]</span><br><span class="line"></span><br><span class="line">all_workbooks = glob.glob(os.path.join(input_folder,&apos;*.xls*&apos;))</span><br><span class="line">data_frame = []</span><br><span class="line">for workbook in all_workbooks:</span><br><span class="line">    all_worksheets = pd.read_excel(workbook,sheetname=None,index_col=None)</span><br><span class="line">    for worksheet_name, data in all_worksheets.items():</span><br><span class="line">        data_frame.append(data)</span><br><span class="line"></span><br><span class="line">all_data_concatenated = pd.concat(data_frame,axis=0,ignore_index=True)</span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">all_data_concatenated.to_excel(writer,sheet_name = &apos;all_group_all_workbooks&apos;,index = False)</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h4 id="3-为每个工作簿和工作表计算总数和均值"><a href="#3-为每个工作簿和工作表计算总数和均值" class="headerlink" title="3. 为每个工作簿和工作表计算总数和均值"></a>3. 为每个工作簿和工作表计算总数和均值</h4><ul>
<li>基础Python</li>
</ul>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys,glob,os</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> date</span><br><span class="line"><span class="keyword">from</span> xlrd <span class="keyword">import</span> open_workbook,xldate_as_tuple</span><br><span class="line"><span class="keyword">from</span> xlwt <span class="keyword">import</span> Workbook</span><br><span class="line"></span><br><span class="line">input_folder = sys.argv[<span class="number">1</span>]</span><br><span class="line">output_file = sys.argv[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">output_workbook = Workbook()</span><br><span class="line">output_worksheet = output_workbook.add_sheet(<span class="string">'sums_add_averages'</span>)</span><br><span class="line"><span class="comment">#输出文件的所有行</span></span><br><span class="line">all_data =[]</span><br><span class="line"><span class="comment">#Sale Amount 的索引值</span></span><br><span class="line">sales_column_index = <span class="number">3</span></span><br><span class="line"><span class="comment">#文件标题列表</span></span><br><span class="line">header = [<span class="string">'workbook'</span>,</span><br><span class="line">          <span class="string">'worksheet'</span>,</span><br><span class="line">          <span class="string">'worksheet_total'</span>,</span><br><span class="line">          <span class="string">'worksheet_average'</span>,</span><br><span class="line">           <span class="string">'workbook_total'</span>,</span><br><span class="line">          <span class="string">'workbook_average'</span>]</span><br><span class="line">all_data.append(header)</span><br><span class="line"></span><br><span class="line"><span class="comment">#遍历文件中所有是 .xls* 的 文件</span></span><br><span class="line"><span class="keyword">for</span> input_file <span class="keyword">in</span>  glob.glob(os.path.join(input_folder,<span class="string">'*.xls*'</span>)):</span><br><span class="line">    <span class="comment">#打开每次遍历到的文件</span></span><br><span class="line">    <span class="keyword">with</span> open_workbook(input_file) <span class="keyword">as</span> workbook:</span><br><span class="line">        list_of_totals = [] <span class="comment">#保存所有的销售额</span></span><br><span class="line">        list_of_number = [] <span class="comment">#销售额数据的个数</span></span><br><span class="line">        workbook_output = [] <span class="comment">#输出文件的所有输出列表</span></span><br><span class="line">        <span class="comment">#遍历文件中的工作表</span></span><br><span class="line">        <span class="keyword">for</span> worksheet <span class="keyword">in</span> workbook.sheets():</span><br><span class="line">            total_sales = <span class="number">0</span></span><br><span class="line">            number_of_sales = <span class="number">0</span></span><br><span class="line">            worksheet_list = []  <span class="comment"># 保存工作表的信息</span></span><br><span class="line">            <span class="comment">#添加工作簿名称和工作表名称</span></span><br><span class="line">            worksheet_list.append(os.path.basename(input_file))</span><br><span class="line">            worksheet_list.append(worksheet.name)</span><br><span class="line">            <span class="comment">#遍历除标题以外的行</span></span><br><span class="line">            <span class="keyword">for</span> row_index <span class="keyword">in</span> range(<span class="number">1</span>,worksheet.nrows):</span><br><span class="line">                <span class="keyword">try</span>:<span class="comment">#算总值</span></span><br><span class="line">                    total_sales += float(str(worksheet.cell_value \</span><br><span class="line">                    (row_index, sales_column_index)) \</span><br><span class="line">                    .strip(<span class="string">'$'</span>).replace(<span class="string">','</span>, <span class="string">''</span>))</span><br><span class="line">                    number_of_sales += <span class="number">1.</span></span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    total_sales += <span class="number">0</span></span><br><span class="line">                    number_of_sales += <span class="number">0</span></span><br><span class="line">            <span class="comment">#算均值</span></span><br><span class="line">            average_sales = <span class="string">'%0.2f'</span> % (total_sales / number_of_sales)</span><br><span class="line">            <span class="comment"># 添加销售总计和均值</span></span><br><span class="line">            worksheet_list.append(total_sales)</span><br><span class="line">            worksheet_list.append(average_sales)</span><br><span class="line">            <span class="comment"># 将工作表的销售额总计和销售额数据个数加紧对应列表</span></span><br><span class="line">            list_of_totals.append(total_sales)</span><br><span class="line">            list_of_number.append(float(average_sales))</span><br><span class="line">            <span class="comment"># 在工作簿级别保存信息</span></span><br><span class="line">            workbook_output.append(worksheet_list)</span><br><span class="line">            <span class="comment"># 使用两个列表计算出的工作簿的销售额总计和销售额均值</span></span><br><span class="line">            workbook_total = sum(list_of_totals)</span><br><span class="line">            workbook_average = sum(list_of_totals) / sum(list_of_number)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#将工作簿级别的销售额总计和均值追加到每个列表中</span></span><br><span class="line">        <span class="keyword">for</span> list_element <span class="keyword">in</span> workbook_output:</span><br><span class="line">            list_element.append(workbook_total)</span><br><span class="line">            list_element.append(workbook_average)</span><br><span class="line">        all_data.extend(workbook_output)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> list_index,output_list <span class="keyword">in</span> enumerate(all_data):</span><br><span class="line">    <span class="keyword">for</span> element_index,element <span class="keyword">in</span> enumerate(output_list):</span><br><span class="line">        output_worksheet.write(list_index, element_index, element)</span><br><span class="line"></span><br><span class="line">output_workbook.save(output_file)</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>pandas<br>pandas 可以直接在多个工作簿之间迭代，并可以同时在工作簿级别和工作表级别计算统计量。计算工作簿级别的统计量，将它们转换成一个数据框，然后通过基于工作簿名称的左连接将两个数据框合并在一起，并将结果数据框添加到一个列表中。当所有工作簿级别的数据框都进入列表之后，将这些数据框连接成一个独立数据框，并写入输出文件.</li>
</ul>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sys,os,glob</span><br><span class="line"></span><br><span class="line">input_path = <span class="string">'/Users/yyf/PycharmProjects/ReadTest/DataSouce/Excel'</span></span><br><span class="line">output_file = <span class="string">'/Users/yyf/PycharmProjects/ReadTest/DataSouce/total_average.xls'</span></span><br><span class="line"></span><br><span class="line">all_workbooks = glob.glob(os.path.join(input_path,<span class="string">'*.xls*'</span>))</span><br><span class="line"></span><br><span class="line">data_frames = []</span><br><span class="line"><span class="keyword">for</span> workbook <span class="keyword">in</span> all_workbooks:</span><br><span class="line">    all_worksheets = pd.read_excel(workbook,sheetname=<span class="keyword">None</span>,index_col=<span class="keyword">None</span>)</span><br><span class="line">    workbook_total_sales = []</span><br><span class="line">    workbook_number_of_sales = []</span><br><span class="line">    worksheet_data_frames = []</span><br><span class="line">    worksheets_data_frame = <span class="keyword">None</span></span><br><span class="line">    workbook_data_frame = <span class="keyword">None</span></span><br><span class="line">    <span class="keyword">for</span> worksheet_name,data <span class="keyword">in</span> all_worksheets.items():</span><br><span class="line">        total_sales= pd.DataFrame([float(str(value).strip(<span class="string">'$'</span>).replace(<span class="string">','</span>,<span class="string">''</span>)) <span class="keyword">for</span> value <span class="keyword">in</span> data.loc[:,<span class="string">'Sale Amount'</span>]]).sum()</span><br><span class="line">        number_of_sales = len(data.loc[:,<span class="string">'Sale Amount'</span>])</span><br><span class="line">        average_sales = pd.DataFrame(total_sales/number_of_sales)</span><br><span class="line">        workbook_total_sales.append(total_sales)</span><br><span class="line">        workbook_number_of_sales.append(number_of_sales)</span><br><span class="line">        data = &#123;<span class="string">'workbook'</span>:os.path.basename(workbook),</span><br><span class="line">                <span class="string">'worksheet'</span>:worksheet_name,</span><br><span class="line">                <span class="string">'worksheet_total'</span>:total_sales,</span><br><span class="line">                <span class="string">'worksheet_average'</span>:average_sales&#125;</span><br><span class="line"></span><br><span class="line">        worksheet_data_frames.append(pd.DataFrame(data,columns=[<span class="string">'workbook'</span>,<span class="string">'worksheet'</span>,<span class="string">'worksheet_total'</span>,<span class="string">'worksheet_average'</span>]))</span><br><span class="line">    worksheets_data_frame = pd.concat(worksheet_data_frames,axis=<span class="number">0</span>,ignore_index=<span class="keyword">True</span>)</span><br><span class="line">    workbook_total = pd.DataFrame(workbook_total_sales).sum()</span><br><span class="line">    workbook_total_number_of_sales = pd.DataFrame(workbook_number_of_sales).sum()</span><br><span class="line">    workbook_average = pd.DataFrame(workbook_total / workbook_total_number_of_sales)</span><br><span class="line">    workbook_stats = &#123;<span class="string">'workbook'</span>: os.path.basename(workbook),</span><br><span class="line">                          <span class="string">'workbook_total'</span>: workbook_total,</span><br><span class="line">                          <span class="string">'workbook_average'</span>: workbook_average&#125;</span><br><span class="line">    workbook_stats = pd.DataFrame(workbook_stats, columns=[<span class="string">'workbook'</span>, <span class="string">'workbook_total'</span>, <span class="string">'workbook_average'</span>])</span><br><span class="line">    workbook_data_frame = pd.merge(worksheets_data_frame, workbook_stats, on=<span class="string">'workbook'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    data_frames.append(workbook_data_frame)</span><br><span class="line"></span><br><span class="line">all_data_concatenated = pd.concat(data_frames,axis=<span class="number">0</span>,ignore_index=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">writer = pd.ExcelWriter(output_file)</span><br><span class="line">all_data_concatenated.to_excel(writer,sheet_name =<span class="string">'sums_and_averages'</span>,index = <span class="keyword">False</span> )</span><br><span class="line">writer.save()</span><br></pre></td></tr></table></figure>
</code></pre>
    </div>

    <div class="post-footer">   
        <div>
            
                转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="" target="_blank">Snippet</a>
            
        </div>
        <div>
            
        </div>  
    </div>
</article>

<div class="article-nav prev-next-wrap clearfix">
    
    
        <a href="/2018/02/06/hello-world/" class="next-post btn btn-default">下一篇<i class="fa fa-angle-right fa-fw"></i></a>
    
</div>


    <div id="comments">
        
	<!--PC和WAP自适应版-->
<div id="SOHUCS"></div>
<script type="text/javascript">
	(function(){var appid='cyt8KmUC1';var conf='prod_855a68d3b3d91855360a6215672a505a';var width=window.innerWidth||document.documentElement.clientWidth;if(width<960){window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id='+appid+'&conf='+conf+'"><\/script>');}else{var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
	c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});}})();
</script>	

    </div>





                </main>
                
    <aside class="col-md-4 sidebar">
        
        
    <div class="widget">    
        <h3 class="title">Search</h3>
        <div id="search-form">
            <div id="result-mask" class="hide"></div>
            <div class="search-area">
                
                    <input id="search-key" type="search" autocomplete="off" placeholder="搜点什么呢?">
                    <button type="button" class="search-form-submit" id="search-local">localSearch</button>
                
                
            </div>
            <div id="result-wrap" class="hide">
                <div id="search-result"></div>
            </div>
            <div class="hide">
                <template id="search-tpl">
                    <div class="item">
                        <a href="/{path}" title="{title}">
                            <div class="title">{title}</div>
                            <div class="content">{content}</div>
                        </a>
                    </div>
                </template>
            </div>
        </div>
    </div>

        
        
    <div class="widget notification">
        <h3 class="title">网站公告</h3>
        <div>
            <p>主题Snippet v1.2.0版本已经上线！欢迎更新~ <br/>
主题下载：<a href="https://github.com/shenliyang/hexo-theme-snippet" title="fork me" target="_blank">Snippet主题</a> <br/>
<hr/>接受贡献，包括不限于提交问题与需求，修复代码。欢迎Pull Request<br/>支持主题：<a href="https://github.com/shenliyang/hexo-theme-snippet/stargazers">Star一下</a>
</p>
        </div>
    </div>

        
        
    <div class="widget">
      <h3 class="title">Social</h3> 
        <div class="content social">
            
	            <a href="//github.com/shenliyang" rel="external nofollow" title="Github" target="_blank">
			    	<i class="git fa fa-git"></i>
			    </a>
            
	            <a href="mailto:snippet@91h5.cc" rel="external nofollow" title="邮箱" target="_blank">
			    	<i class="envelope-o fa fa-envelope-o"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="联系QQ" target="_blank">
			    	<i class="qq fa fa-qq"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="微博" target="_blank">
			    	<i class="weibo fa fa-weibo"></i>
			    </a>
            
	            <a href="/" rel="external nofollow" title="QQ群" target="_blank">
			    	<i class="users fa fa-users"></i>
			    </a>
            
	            <a href="/atom.xml" rel="external nofollow" title="RSS" target="_blank">
			    	<i class="feed fa fa-feed"></i>
			    </a>
            
        </div>
    </div>


        
        

        
        
    <div class="widget">
      <h3 class="title">Archives</h3>
        <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/"><i class="fa" aria-hidden="true">February 2018</i></a><span class="archive-list-count">2</span></li></ul>
    </div>


        
        
  <div class="widget">
    <h3 class="title">Tag Cloud</h3>
    <div class="content tag-cloud">
        <a href="/tags/Python-笔记/" style="font-size: 10px;">Python 笔记</a>
    </div>
  </div>


        
        
    <div class="widget">
        <h3 class="title">Friends</h3>
        <div class="content friends-link">
        
            <a href="http://www.shenliyang.com" class="fa" target="_blank">个人博客</a>
        
        </div>
    </div>


        
    </aside>

            </div>
        </div>
    </section>
    <footer class="main-footer">
    <div class="container">
        <div class="row">
        </div>
    </div>
</footer>

<a id="back-to-top" class="hide">
	<i class="fa fa-chevron-up"></i>
</a>




    <div class="copyright">
    <div class="container">
        <div class="row">
            <div class="col-sm-12"> 
                <span>Copyright &copy; 2017
                </span> | 
                <span>
                    Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a>
                </span> | 
                <span>
                    Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a>
                </span>
            </div>
        </div>
    </div>
</div>



	<script src="/js/search.js?rev=@@hash"></script>


<script src="/js/app.js?rev=@@hash"></script>


</body>
</html>